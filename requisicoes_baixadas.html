<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Requisi√ß√µes com Baixa Realizada</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

<h1>Requisi√ß√µes com Baixa Realizada</h1>

<input type="text" id="searchCodigo" placeholder="Buscar por c√≥digo">
<button id="searchBtn">Buscar</button>

<a href="requisicoes.html"> <button class="voltar" type="button">Requisi√ß√µes</button></a>

<table>
    <thead>
        <tr>
            <th>C√≥digo</th>
            <th>C√≥digo Produto</th>
            <th>Nome</th>
            <th>Data/Hora</th>
            <th>Transfer√™ncia</th>
            <th>Solicitante</th>
            <th>Respons√°vel</th>
            <th>A√ß√µes</th>
        </tr>
    </thead>
    <tbody id="baixasBody">
        <!-- As requisi√ß√µes baixadas aparecer√£o aqui -->
    </tbody>
</table>

<script>
    let requisicoesBaixadas = JSON.parse(localStorage.getItem('requisicoesBaixadas')) || [];
    let fotosRequisicao = JSON.parse(localStorage.getItem('fotosRequisicao')) || {};

    // Fun√ß√£o para renderizar a tabela de requisi√ß√µes baixadas
    function renderizarTabela(requisicoesFiltradas = requisicoesBaixadas) {
        const tbody = document.getElementById('baixasBody');
        if (!tbody) return;
        tbody.innerHTML = '';
        requisicoesFiltradas.forEach(requisicao => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${requisicao.numero}</td>
                <td>${requisicao.codigo}</td>
                <td>${requisicao.nome}</td>
                <td>${requisicao.dataHora}</td>
                <td>${requisicao.transferencia}</td>
                <td>${requisicao.solicitante}</td>
                <td>${requisicao.responsavel}</td>
                <td>
                    <button onclick="verFotos(${requisicao.numero})">üì∑ Ver Fotos</button>
                </td>
            `;
            tbody.appendChild(tr);
        });
    }

    // Fun√ß√£o para visualizar fotos da requisi√ß√£o baixada
    function verFotos(numero) {
        const fotos = fotosRequisicao[numero] || [];
        if (fotos.length > 0) {
            const modal = document.createElement('div');
            modal.classList.add('modal');
            modal.innerHTML = `
                <div class="modal-content">
                    <h2>Fotos da Requisi√ß√£o</h2>
                    ${fotos.map(foto => `<img src="${foto}" alt="Foto da Requisi√ß√£o" style="width: 100px; margin: 10px;">`).join('')}
                    <button onclick="document.body.removeChild(modal)">Fechar</button>
                </div>
            `;
            document.body.appendChild(modal);
        } else {
            alert('Nenhuma foto dispon√≠vel para esta requisi√ß√£o.');
        }
    }

    // Fun√ß√£o para buscar requisi√ß√µes por c√≥digo
    document.getElementById('searchBtn').addEventListener('click', function () {
        const searchValue = document.getElementById('searchCodigo').value.toLowerCase();
        const requisicoesFiltradas = requisicoesBaixadas.filter(req =>
            req.codigo.toLowerCase().includes(searchValue) || req.nome.toLowerCase().includes(searchValue)
        );
        renderizarTabela(requisicoesFiltradas);
    });

    // Inicializar a tabela de requisi√ß√µes baixadas
    renderizarTabela();
</script>

</body>
</html>
